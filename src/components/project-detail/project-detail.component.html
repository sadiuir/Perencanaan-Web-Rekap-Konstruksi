@if(project(); as proj) {
<div class="space-y-6">
    <!-- Project Header -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-3xl font-bold text-primary-dark">{{ proj.name }}</h2>
        <p class="text-gray-600 mt-1">{{ proj.code }} - {{ proj.location }}</p>
        <div class="mt-4 flex flex-wrap gap-x-6 gap-y-2 text-sm">
            <div class="flex items-center text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                <span>{{ proj.startDate | date:'longDate' }} - {{ proj.targetEndDate | date:'longDate' }}</span>
            </div>
            <div class="flex items-center text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>
                <span class="font-semibold">Rp {{ proj.contractValue | number:'1.0-0':'id' }}</span>
            </div>
        </div>
    </div>
    
    <!-- Financial Summary -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded-lg shadow">
            <p class="text-sm text-gray-500">Contract Value</p>
            <p class="text-2xl font-bold text-primary-dark mt-1">Rp {{ financialSummary().totalContractValue | number:'1.0-0':'id' }}</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow">
            <p class="text-sm text-gray-500">Total Spent</p>
            <p class="text-2xl font-bold text-red-600 mt-1">Rp {{ financialSummary().totalSpent | number:'1.0-0':'id' }}</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow">
            <p class="text-sm text-gray-500">Remaining Budget</p>
            <p class="text-2xl font-bold text-green-600 mt-1">Rp {{ financialSummary().remainingBudget | number:'1.0-0':'id' }}</p>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-gray-200">
        <button (click)="setTab('overview')" [class.border-primary]="activeTab() === 'overview'" [class.text-primary]="activeTab() === 'overview'" class="px-4 py-2 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary focus:outline-none">Overview</button>
        <button (click)="setTab('rab')" [class.border-primary]="activeTab() === 'rab'" [class.text-primary]="activeTab() === 'rab'" class="px-4 py-2 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary focus:outline-none">RAB / BoQ</button>
        <button (click)="setTab('reports')" [class.border-primary]="activeTab() === 'reports'" [class.text-primary]="activeTab() === 'reports'" class="px-4 py-2 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-primary focus:outline-none">Daily Reports</button>
         @if(canSubmitReport()){
          <button class="ml-auto px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-t-lg hover:bg-green-700 transition-colors">
            + New Report
          </button>
        }
    </div>

    <!-- Tab Content -->
    <div class="bg-white p-6 rounded-lg shadow">
        @switch (activeTab()) {
            @case ('overview') {
                <h3 class="text-xl font-bold text-gray-800 mb-4">Project Overview</h3>
                <p>S-Curve and other charts would be displayed here.</p>
                <!-- S-Curve placeholder -->
                <div class="mt-4 w-full h-80 bg-slate-100 rounded-lg flex items-center justify-center">
                    <p class="text-slate-500">S-Curve Chart Area</p>
                </div>
            }
            @case ('rab') {
                <h3 class="text-xl font-bold text-gray-800 mb-4">Rencana Anggaran Biaya (RAB)</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Work Item</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Volume</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Unit Price</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Plan</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Plan</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @for(item of rabItems(); track item.id){
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.masterItem?.name }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{{ item.targetVolume }} {{item.masterItem?.unit}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{{ item.unitPrice | number:'1.0-0':'id' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ item.scheduleStartDate ? (item.scheduleStartDate | date:'mediumDate') : 'N/A' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ item.scheduleEndDate ? (item.scheduleEndDate | date:'mediumDate') : 'N/A' }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 text-right">{{ item.totalPrice | number:'1.0-0':'id' }}</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            @case ('reports') {
                <h3 class="text-xl font-bold text-gray-800 mb-4">Daily Reports</h3>
                <div class="space-y-4">
                    @for(report of reports(); track report.id) {
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <p class="font-bold text-gray-800">{{ report.reportDate | date:'fullDate' }}</p>
                            <span [class.bg-yellow-100]="report.status === 'Pending'" [class.text-yellow-800]="report.status === 'Pending'"
                                  [class.bg-green-100]="report.status === 'Approved'" [class.text-green-800]="report.status === 'Approved'"
                                  [class.bg-red-100]="report.status === 'Rejected'" [class.text-red-800]="report.status === 'Rejected'"
                                  class="text-xs font-semibold px-2.5 py-1 rounded-full">{{ report.status }}</span>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">Reported by {{ getReporterName(report.reporterId) }} | Weather: {{report.weather}}</p>
                        <p class="text-sm text-gray-700 mt-2 italic">"{{ report.notes }}"</p>
                        
                        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                             <div>
                                 <h4 class="font-semibold text-gray-700">Progress:</h4>
                                 @if (report.progressItems.length > 0) {
                                     <ul class="list-disc pl-5 text-gray-600">
                                        @for(item of report.progressItems; track item.rabItemId){
                                          <li>{{ getRabItemName(item.rabItemId) }}: {{ item.volumeCompleted }} {{ getRabItemUnit(item.rabItemId) }}</li>
                                        }
                                     </ul>
                                 } @else {
                                    <p class="text-gray-500 pl-5">No progress reported.</p>
                                 }
                             </div>
                             <div>
                                 <h4 class="font-semibold text-gray-700">Material Usage:</h4>
                                 @if (report.materialUsage.length > 0) {
                                     <ul class="list-disc pl-5 text-gray-600">
                                        @for(item of report.materialUsage; track item.masterMaterialId){
                                          <li>{{ getMaterialName(item.masterMaterialId) }}: {{ item.volumeUsed }}</li>
                                        }
                                     </ul>
                                 } @else {
                                    <p class="text-gray-500 pl-5">No materials used.</p>
                                 }
                             </div>
                             <div>
                                 <h4 class="font-semibold text-gray-700">Issues / Obstacles:</h4>
                                 @if(report.issues.length > 0) {
                                     <ul class="list-disc pl-5 text-gray-600">
                                        @for(issue of report.issues; track issue.id){
                                          <li>{{issue.description}} <span class="text-xs font-semibold">({{issue.category}} - {{issue.status}})</span></li>
                                        }
                                     </ul>
                                 } @else {
                                    <p class="text-gray-500 pl-5">No issues reported.</p>
                                 }
                             </div>
                        </div>
                    </div>
                    } @empty {
                       <p class="text-gray-500">No daily reports have been submitted for this project yet.</p>
                    }
                </div>
            }
        }
    </div>
</div>
} @else {
    <p>Loading project details...</p>
}