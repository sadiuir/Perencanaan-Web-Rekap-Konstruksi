<div class="bg-white p-6 rounded-lg shadow">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">Pending Reports for Validation</h2>
  
  @if(pendingReports().length > 0) {
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Project</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reporter</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for(report of pendingReports(); track report.id) {
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">{{ report.reportDate | date:'longDate' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ getProjectName(report.projectId) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ getReporterName(report.reporterId) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button (click)="viewReport(report)" class="text-primary hover:text-primary-dark">Review</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="text-center py-12">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900">All caught up!</h3>
      <p class="mt-1 text-sm text-gray-500">There are no pending reports to validate.</p>
    </div>
  }
</div>


<!-- Review Modal -->
@if(selectedReport(); as report) {
<div class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4" (click)="closeModal()">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-full overflow-y-auto" (click)="$event.stopPropagation()">
    <div class="p-6 border-b flex justify-between items-center">
      <h3 class="text-xl font-bold text-gray-800">Review Report: {{ report.reportDate | date:'longDate' }}</h3>
      <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
    </div>
    <div class="p-6 space-y-4">
      <div>
        <h4 class="font-semibold text-gray-700">Project:</h4>
        <p class="text-gray-600">{{ getProjectName(report.projectId) }}</p>
      </div>
       <div>
        <h4 class="font-semibold text-gray-700">Reported by:</h4>
        <p class="text-gray-600">{{ getReporterName(report.reporterId) }}</p>
      </div>
      <div>
        <h4 class="font-semibold text-gray-700">Weather:</h4>
        <p class="text-gray-600">{{ report.weather }}</p>
      </div>
      <div>
        <h4 class="font-semibold text-gray-700">Notes:</h4>
        <p class="text-gray-600 italic">"{{ report.notes }}"</p>
      </div>
      <div>
        <h4 class="font-semibold text-gray-700">Photo Documentation:</h4>
        @for(photo of report.photos; track photo){
            <img [src]="photo" alt="Documentation photo" class="mt-2 rounded-lg shadow-md max-w-sm"/>
        }
      </div>
       <div>
        <h4 class="font-semibold text-gray-700">Work Progress:</h4>
        <ul class="list-disc pl-5 text-sm text-gray-600">
           @for(item of report.progressItems; track item.rabItemId){
             <li>{{ getRabItemName(item.rabItemId) }}: {{ item.volumeCompleted }} {{ getRabItemUnit(item.rabItemId) }}</li>
           }
        </ul>
      </div>
      <div>
        <h4 class="font-semibold text-gray-700">Material Usage:</h4>
        @if (report.materialUsage.length > 0) {
            <ul class="list-disc pl-5 text-sm text-gray-600">
               @for(item of report.materialUsage; track item.masterMaterialId){
                 <li>{{ getMaterialName(item.masterMaterialId) }}: {{ item.volumeUsed }}</li>
               }
            </ul>
        } @else {
            <p class="text-sm text-gray-500">No materials were reported as used.</p>
        }
      </div>
       <div>
        <h4 class="font-semibold text-gray-700">Reported Issues:</h4>
        @if (report.issues.length > 0) {
            <ul class="list-disc pl-5 text-sm text-gray-600">
               @for(issue of report.issues; track issue.id){
                 <li>{{issue.description}} <span class="text-xs font-semibold">({{issue.category}} - {{issue.status}})</span></li>
               }
            </ul>
        } @else {
            <p class="text-sm text-gray-500">No issues were reported.</p>
        }
      </div>
    </div>
    <div class="p-6 bg-gray-50 border-t flex justify-end space-x-3">
      <button (click)="rejectReport(report.id)" class="px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700">Reject</button>
      <button (click)="approveReport(report.id)" class="px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700">Approve</button>
    </div>
  </div>
</div>
}